@model IEnumerable<DigitaLibrary.Models.AcademicWork>

@{
    ViewData["Title"] = "Ana Sayfa";
}

<style>
    /* Kapak görseli hover’da büyüsün */
    .work-cover {
        transition: transform .3s ease;
        display: block;
    }

    .work-card:hover .work-cover {
        transform: scale(1.05);
    }

    /* İkon butonları */
    .icon-btn {
        border: 0;
        background: transparent;
        padding: 0;
        cursor: pointer;
        font-size: 1.25rem;
        line-height: 1;
    }

    /* 🔽 EK: Kart boyutlarını profildeki gibi yap */
    .work-card {
        border-radius: 12px;
        overflow: hidden;
    }

        .work-card img.work-cover {
            height: 180px; /* kapak yüksekliği */
            object-fit: cover; /* kırpma ile hizala */
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        .work-card .card-body {
            padding: 10px 12px;
        }

        .work-card .card-title {
            font-size: 0.95rem;
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 6px;
            /* max 2 satır */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .work-card .card-footer {
            padding: 6px 12px;
            font-size: 0.85rem;
        }
</style>

<div class="container py-4">
    <h2 class="mb-3">Son Çalışmalar</h2>

    @if (!Model.Any())
    {
        <div class="alert alert-info">Hiç çalışma bulunamadı.</div>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-3 g-4">
            @foreach (var w in Model)
            {
                <div class="col">
                    <div class="card h-100 shadow-sm work-card">

                        <!-- Kapak -->
                        <a asp-controller="AcademicWorks" asp-action="Details" asp-route-slug="@w.Slug"
                           class="text-decoration-none text-dark d-block">

                            <div class="overflow-hidden">
                                @if (!string.IsNullOrWhiteSpace(w.CoverImagePath))
                                {
                                    <img src="@Url.Content(w.CoverImagePath)" class="card-img-top work-cover" alt="@w.Title" />
                                }
                                else
                                {
                                    <img src="~/images/no-cover.png" class="card-img-top work-cover" alt="Kapak yok" />
                                }
                            </div>

                            <div class="card-body text-center">
                                <h5 class="card-title mb-0">@w.Title</h5>
                            </div>
                        </a>


                        <!-- Alt bilgi -->
                        <div class="card-footer d-flex justify-content-between small text-muted">
                            <span>@w.Category?.Name</span>
                            <span>@w.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy")</span>
                        </div>

                        <!-- Yazar + Beğen/Kaydet -->
                        <div class="card-footer d-flex justify-content-between align-items-center">
                            <div class="text-muted small">
                                @w.Author?.DisplayName
                            </div>

                            <div class="d-flex gap-3 align-items-center">

                                <!-- Beğeni (Favori) -->
                                <form asp-controller="Favorites" asp-action="Toggle" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="workId" value="@w.Id" />
                                    <button type="submit" class="icon-btn" title="Beğen">
                                        @if (ViewBag.FavIds != null && ((HashSet<int>)ViewBag.FavIds).Contains(w.Id))
                                        {
                                            <i class="bi bi-heart-fill text-danger"></i>   @* DOLU KIRMIZI *@
                                        }
                                        else
                                        {
                                            <i class="bi bi-heart"></i>                     @* BOŞ *@
                                        }
                                    </button>
                                </form>

                                <!-- Kaydet (Bookmark) -->
                                <form asp-controller="Bookmarks" asp-action="Toggle" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="workId" value="@w.Id" />
                                    <button type="submit" class="icon-btn" title="Kaydet">
                                        @if (ViewBag.BmIds != null && ((HashSet<int>)ViewBag.BmIds).Contains(w.Id))
                                        {
                                            <i class="bi bi-bookmark-fill text-primary"></i> @* DOLU MAVİ *@
                                        }
                                        else
                                        {
                                            <i class="bi bi-bookmark"></i>                   @* BOŞ *@
                                        }
                                    </button>
                                </form>

                            </div>
                        </div>

                    </div>
                </div>
            }
        </div>
    }
</div>
